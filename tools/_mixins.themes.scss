
// =======================================
// ^MIXINS.THEMES
// =======================================

// ---------------------------------------
// Extend theme
// ---------------------------------------

@mixin ekzo-extend-themes($theme-name, $theme, $default: false) {

  $ekzo-themes: () !default;
  $new-theme:   ();

  @if type-of($theme) != 'map' {
    @error '[ekzo-extend-themes] `$theme` value type should be `map`, not `#{type-of($theme)}`';
  }

  @if not map-has-key($ekzo-themes, $theme-name) {
    $new-theme: ($theme-name: $theme);
  } @else {
    $existing-theme: map-get($ekzo-themes, $theme-name);

    @if $default {
      $new-theme: map-merge($theme, $existing-theme);
    } @else {
      $new-theme: map-merge($existing-theme, $theme);
    }

    $new-theme: ($theme-name: $new-theme);
  }

  $ekzo-themes: map-merge($ekzo-themes, $new-theme) !global;

}

// ---------------------------------------
// Themify
// ---------------------------------------
// Write themified code without breaking modular project structure
// Improved version of http://www.sitepoint.com/sass-theming-neverending-story/
//
// @example
//  .foo {
//    @include ekzo-theme() { background: ekzo-theme(bg); }
//
//    .bar {
//      @include ekzo-theme() {
//        color: black;
//        background: ekzo-theme(text);
//      }
//    }
//
//  }

@mixin ekzo-theme($prefix: $ekzo-themes-ns, $postfix: '', $also-chain:true, $enable-theming: $ekzo-enable-theming, $default-theme: base) {

  @each $theme, $data in $ekzo-themes {

    @include ekzo-set-temp(theme, $data);

    $class: $prefix + $theme + $postfix;

    @if $enable-theming and $also-chain {
      .#{$class} &,
      &.#{$class} { @content; }
    } @else if $enable-theming {
      .#{$class} & { @content; }
    } @else {
      @if $theme == $default-theme { @content; }
    }

    @include ekzo-purge-temp();

  }

}